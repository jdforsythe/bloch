"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Get the current balance for any wallet address
 *
 * Last known balance is the last time the user sent coins anywhere (their address
 * was the input address to a transaction) because they have to send their whole
 * balance. If they've never sent coins, start with zero.
 *
 * From that known point, we add up all the coinbase amounts and deposits thereafter
 * and accumulate a balance
 */
function getCurrentBalance(address, blocks) {
    let initialBalance = 0;
    const blocksSinceLastSpend = getDescendingBlocksSince(blocks, (b) => {
        // does the block have an input address matching the given address?
        return !!b.data.slice(1).find((tx) => tx.input.address === address);
    });
    // they spent at some time in the block history
    if (blocksSinceLastSpend.length !== blocks.length) {
        const lastSpendBlock = blocksSinceLastSpend.pop();
        const lastSpendTx = lastSpendBlock.data.slice(1).reverse().find((tx) => tx.input.address === address);
        // the last known balance is the output amount to the same wallet in the last spend transaction
        initialBalance = lastSpendTx.outputs.find((txOut) => txOut.address === address).amount;
        // if the same user got the block reward on that block, add that in as well
        const lastSpendCoinbaseDeposit = lastSpendBlock.data[0].outputs[0];
        if (lastSpendCoinbaseDeposit.address === address) {
            initialBalance += lastSpendCoinbaseDeposit.amount;
        }
    }
    return getAccumulatedBalance(initialBalance, address, blocksSinceLastSpend);
}
exports.getCurrentBalance = getCurrentBalance;
/**
 * Get blocks, in descending order, until the block matches the predicate (inclusive of the match)
 */
function getDescendingBlocksSince(allBlocks, predicateFn) {
    const descending = [...allBlocks].reverse();
    const blocksSince = [];
    for (const block of descending) {
        blocksSince.push(block);
        if (predicateFn(block)) {
            break;
        }
    }
    return blocksSince;
}
function getCoinbaseDeposits(address, coinbaseTxs) {
    return coinbaseTxs.reduce((acc, coinbaseTx) => {
        acc.push(...coinbaseTx.outputs.filter((outputTx) => outputTx.address === address));
        return acc;
    }, []);
}
function getTransactionsAndCoinbases(blocks) {
    return blocks.reduce((acc, block) => {
        acc.coinbaseTxs.push(block.data[0]);
        acc.transactions.push(...block.data.slice(1));
        return acc;
    }, { coinbaseTxs: [], transactions: [] });
}
function getWithdrawalsAndDeposits(address, transactions) {
    return transactions.reduce((acc, transaction) => {
        if (transaction.input.address === address) {
            acc.withdrawals.push(transaction.input);
        }
        acc.deposits.push(...transaction.outputs.filter((outputTx) => outputTx.address === address));
        return acc;
    }, { withdrawals: [], deposits: [] });
}
function getAccumulatedBalance(initialBalance, address, blocks) {
    const { coinbaseTxs, transactions } = getTransactionsAndCoinbases(blocks);
    const { withdrawals, deposits } = getWithdrawalsAndDeposits(address, transactions);
    // we also need to check if we have any coinbase (block reward) deposits to add
    deposits.push(...getCoinbaseDeposits(address, coinbaseTxs));
    const balance = withdrawals.reduce((acc, inputTx) => acc - inputTx.amount, initialBalance);
    return deposits.reduce((acc, outputTx) => acc + outputTx.amount, balance);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2FsbGV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NoYWluL3dhbGxldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQVFBOzs7Ozs7Ozs7R0FTRztBQUNILFNBQWdCLGlCQUFpQixDQUFDLE9BQWUsRUFBRSxNQUFlO0lBQ2hFLElBQUksY0FBYyxHQUFHLENBQUMsQ0FBQztJQUV2QixNQUFNLG9CQUFvQixHQUFZLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxDQUFDLENBQVEsRUFBRSxFQUFFO1FBQ2xGLG1FQUFtRTtRQUNuRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFxQixFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxPQUFPLENBQUMsQ0FBQztJQUN6RixDQUFDLENBQUMsQ0FBQztJQUVILCtDQUErQztJQUMvQyxJQUFJLG9CQUFvQixDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsTUFBTSxFQUFFO1FBQ2pELE1BQU0sY0FBYyxHQUFHLG9CQUFvQixDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRWxELE1BQU0sV0FBVyxHQUF1QixjQUFjLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFxQixFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxPQUFPLENBQUMsQ0FBQztRQUU3SSwrRkFBK0Y7UUFDL0YsY0FBYyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBd0IsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFFMUcsMkVBQTJFO1FBQzNFLE1BQU0sd0JBQXdCLEdBQUcsY0FBYyxDQUFDLElB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QUMsT0FBTyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBRW5GLCtFQUErRTtJQUMvRSxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsbUJBQW1CLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFFNUQsTUFBTSxPQUFPLEdBQVcsV0FBVyxDQUFDLE1BQU0sQ0FDeEMsQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFDdEMsY0FBYyxDQUNmLENBQUM7SUFFRixPQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztBQUM1RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQmxvY2ssXG4gIFNpZ25lZFRyYW5zYWN0aW9uSW5wdXQsXG4gIFRyYW5zYWN0aW9uT3V0cHV0LFxuICBTaWduZWRUcmFuc2FjdGlvbixcbiAgQ29pbmJhc2VUcmFuc2FjdGlvbixcbn0gZnJvbSAnLi9pbnRlcmZhY2UnO1xuXG4vKipcbiAqIEdldCB0aGUgY3VycmVudCBiYWxhbmNlIGZvciBhbnkgd2FsbGV0IGFkZHJlc3NcbiAqXG4gKiBMYXN0IGtub3duIGJhbGFuY2UgaXMgdGhlIGxhc3QgdGltZSB0aGUgdXNlciBzZW50IGNvaW5zIGFueXdoZXJlICh0aGVpciBhZGRyZXNzXG4gKiB3YXMgdGhlIGlucHV0IGFkZHJlc3MgdG8gYSB0cmFuc2FjdGlvbikgYmVjYXVzZSB0aGV5IGhhdmUgdG8gc2VuZCB0aGVpciB3aG9sZVxuICogYmFsYW5jZS4gSWYgdGhleSd2ZSBuZXZlciBzZW50IGNvaW5zLCBzdGFydCB3aXRoIHplcm8uXG4gKlxuICogRnJvbSB0aGF0IGtub3duIHBvaW50LCB3ZSBhZGQgdXAgYWxsIHRoZSBjb2luYmFzZSBhbW91bnRzIGFuZCBkZXBvc2l0cyB0aGVyZWFmdGVyXG4gKiBhbmQgYWNjdW11bGF0ZSBhIGJhbGFuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRCYWxhbmNlKGFkZHJlc3M6IHN0cmluZywgYmxvY2tzOiBCbG9ja1tdKSB7XG4gIGxldCBpbml0aWFsQmFsYW5jZSA9IDA7XG5cbiAgY29uc3QgYmxvY2tzU2luY2VMYXN0U3BlbmQ6IEJsb2NrW10gPSBnZXREZXNjZW5kaW5nQmxvY2tzU2luY2UoYmxvY2tzLCAoYjogQmxvY2spID0+IHtcbiAgICAvLyBkb2VzIHRoZSBibG9jayBoYXZlIGFuIGlucHV0IGFkZHJlc3MgbWF0Y2hpbmcgdGhlIGdpdmVuIGFkZHJlc3M/XG4gICAgcmV0dXJuICEhYi5kYXRhLnNsaWNlKDEpLmZpbmQoKHR4OiBTaWduZWRUcmFuc2FjdGlvbikgPT4gdHguaW5wdXQuYWRkcmVzcyA9PT0gYWRkcmVzcyk7XG4gIH0pO1xuXG4gIC8vIHRoZXkgc3BlbnQgYXQgc29tZSB0aW1lIGluIHRoZSBibG9jayBoaXN0b3J5XG4gIGlmIChibG9ja3NTaW5jZUxhc3RTcGVuZC5sZW5ndGggIT09IGJsb2Nrcy5sZW5ndGgpIHtcbiAgICBjb25zdCBsYXN0U3BlbmRCbG9jayA9IGJsb2Nrc1NpbmNlTGFzdFNwZW5kLnBvcCgpO1xuXG4gICAgY29uc3QgbGFzdFNwZW5kVHggPSA8U2lnbmVkVHJhbnNhY3Rpb24+IGxhc3RTcGVuZEJsb2NrLmRhdGEuc2xpY2UoMSkucmV2ZXJzZSgpLmZpbmQoKHR4OiBTaWduZWRUcmFuc2FjdGlvbikgPT4gdHguaW5wdXQuYWRkcmVzcyA9PT0gYWRkcmVzcyk7XG5cbiAgICAvLyB0aGUgbGFzdCBrbm93biBiYWxhbmNlIGlzIHRoZSBvdXRwdXQgYW1vdW50IHRvIHRoZSBzYW1lIHdhbGxldCBpbiB0aGUgbGFzdCBzcGVuZCB0cmFuc2FjdGlvblxuICAgIGluaXRpYWxCYWxhbmNlID0gbGFzdFNwZW5kVHgub3V0cHV0cy5maW5kKCh0eE91dDogVHJhbnNhY3Rpb25PdXRwdXQpID0+IHR4T3V0LmFkZHJlc3MgPT09IGFkZHJlc3MpLmFtb3VudDtcblxuICAgIC8vIGlmIHRoZSBzYW1lIHVzZXIgZ290IHRoZSBibG9jayByZXdhcmQgb24gdGhhdCBibG9jaywgYWRkIHRoYXQgaW4gYXMgd2VsbFxuICAgIGNvbnN0IGxhc3RTcGVuZENvaW5iYXNlRGVwb3NpdCA9IGxhc3RTcGVuZEJsb2NrLmRhdGFbMF0ub3V0cHV0c1swXTtcblxuICAgIGlmIChsYXN0U3BlbmRDb2luYmFzZURlcG9zaXQuYWRkcmVzcyA9PT0gYWRkcmVzcykge1xuICAgICAgaW5pdGlhbEJhbGFuY2UgKz0gbGFzdFNwZW5kQ29pbmJhc2VEZXBvc2l0LmFtb3VudDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZ2V0QWNjdW11bGF0ZWRCYWxhbmNlKGluaXRpYWxCYWxhbmNlLCBhZGRyZXNzLCBibG9ja3NTaW5jZUxhc3RTcGVuZCk7XG59XG5cbi8qKlxuICogR2V0IGJsb2NrcywgaW4gZGVzY2VuZGluZyBvcmRlciwgdW50aWwgdGhlIGJsb2NrIG1hdGNoZXMgdGhlIHByZWRpY2F0ZSAoaW5jbHVzaXZlIG9mIHRoZSBtYXRjaClcbiAqL1xuZnVuY3Rpb24gZ2V0RGVzY2VuZGluZ0Jsb2Nrc1NpbmNlKGFsbEJsb2NrczogQmxvY2tbXSwgcHJlZGljYXRlRm46IChiOiBCbG9jaykgPT4gYm9vbGVhbik6IEJsb2NrW10ge1xuICBjb25zdCBkZXNjZW5kaW5nID0gWy4uLmFsbEJsb2Nrc10ucmV2ZXJzZSgpO1xuXG4gIGNvbnN0IGJsb2Nrc1NpbmNlOiBCbG9ja1tdID0gW107XG5cbiAgZm9yIChjb25zdCBibG9jayBvZiBkZXNjZW5kaW5nKSB7XG4gICAgYmxvY2tzU2luY2UucHVzaChibG9jayk7XG5cbiAgICBpZiAocHJlZGljYXRlRm4oYmxvY2spKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYmxvY2tzU2luY2U7XG59XG5cbmZ1bmN0aW9uIGdldENvaW5iYXNlRGVwb3NpdHMoYWRkcmVzczogc3RyaW5nLCBjb2luYmFzZVR4czogQ29pbmJhc2VUcmFuc2FjdGlvbltdKTogVHJhbnNhY3Rpb25PdXRwdXRbXSB7XG4gIHJldHVybiBjb2luYmFzZVR4cy5yZWR1Y2UoXG4gICAgKGFjYywgY29pbmJhc2VUeDogQ29pbmJhc2VUcmFuc2FjdGlvbikgPT4ge1xuICAgICAgYWNjLnB1c2goLi4uY29pbmJhc2VUeC5vdXRwdXRzLmZpbHRlcigob3V0cHV0VHg6IFRyYW5zYWN0aW9uT3V0cHV0KSA9PiBvdXRwdXRUeC5hZGRyZXNzID09PSBhZGRyZXNzKSk7XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSxcbiAgICBbXSxcbiAgKTtcbn1cblxuaW50ZXJmYWNlIFRyYW5zYWN0aW9uc0FuZENvaW5iYXNlcyB7XG4gIGNvaW5iYXNlVHhzOiBDb2luYmFzZVRyYW5zYWN0aW9uW107XG4gIHRyYW5zYWN0aW9uczogU2lnbmVkVHJhbnNhY3Rpb25bXTtcbn1cblxuZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25zQW5kQ29pbmJhc2VzKGJsb2NrczogQmxvY2tbXSk6IFRyYW5zYWN0aW9uc0FuZENvaW5iYXNlcyB7XG4gIHJldHVybiBibG9ja3MucmVkdWNlKFxuICAgIChhY2MsIGJsb2NrOiBCbG9jaykgPT4ge1xuICAgICAgYWNjLmNvaW5iYXNlVHhzLnB1c2goYmxvY2suZGF0YVswXSk7XG4gICAgICBhY2MudHJhbnNhY3Rpb25zLnB1c2goLi4uYmxvY2suZGF0YS5zbGljZSgxKSk7XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSxcbiAgICB7IGNvaW5iYXNlVHhzOiBbXSwgdHJhbnNhY3Rpb25zOiBbXSB9LFxuICApO1xufVxuXG5pbnRlcmZhY2UgV2l0aGRyYXdhbHNBbmREZXBvc2l0cyB7XG4gIHdpdGhkcmF3YWxzOiBTaWduZWRUcmFuc2FjdGlvbklucHV0W107XG4gIGRlcG9zaXRzOiBUcmFuc2FjdGlvbk91dHB1dFtdO1xufVxuXG5mdW5jdGlvbiBnZXRXaXRoZHJhd2Fsc0FuZERlcG9zaXRzKGFkZHJlc3M6IHN0cmluZywgdHJhbnNhY3Rpb25zOiBTaWduZWRUcmFuc2FjdGlvbltdKTogV2l0aGRyYXdhbHNBbmREZXBvc2l0cyB7XG4gIHJldHVybiB0cmFuc2FjdGlvbnMucmVkdWNlKFxuICAgIChhY2MsIHRyYW5zYWN0aW9uOiBTaWduZWRUcmFuc2FjdGlvbikgPT4ge1xuICAgICAgaWYgKHRyYW5zYWN0aW9uLmlucHV0LmFkZHJlc3MgPT09IGFkZHJlc3MpIHtcbiAgICAgICAgYWNjLndpdGhkcmF3YWxzLnB1c2godHJhbnNhY3Rpb24uaW5wdXQpO1xuICAgICAgfVxuXG4gICAgICBhY2MuZGVwb3NpdHMucHVzaCguLi50cmFuc2FjdGlvbi5vdXRwdXRzLmZpbHRlcigob3V0cHV0VHg6IFRyYW5zYWN0aW9uT3V0cHV0KSA9PiBvdXRwdXRUeC5hZGRyZXNzID09PSBhZGRyZXNzKSk7XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSxcbiAgICB7IHdpdGhkcmF3YWxzOiBbXSwgZGVwb3NpdHM6IFtdIH0sXG4gICk7XG59XG5cbmZ1bmN0aW9uIGdldEFjY3VtdWxhdGVkQmFsYW5jZShpbml0aWFsQmFsYW5jZTogbnVtYmVyLCBhZGRyZXNzOiBzdHJpbmcsIGJsb2NrczogQmxvY2tbXSkge1xuICBjb25zdCB7IGNvaW5iYXNlVHhzLCB0cmFuc2FjdGlvbnMgfSA9IGdldFRyYW5zYWN0aW9uc0FuZENvaW5iYXNlcyhibG9ja3MpO1xuICBjb25zdCB7IHdpdGhkcmF3YWxzLCBkZXBvc2l0cyB9ID0gZ2V0V2l0aGRyYXdhbHNBbmREZXBvc2l0cyhhZGRyZXNzLCB0cmFuc2FjdGlvbnMpO1xuXG4gIC8vIHdlIGFsc28gbmVlZCB0byBjaGVjayBpZiB3ZSBoYXZlIGFueSBjb2luYmFzZSAoYmxvY2sgcmV3YXJkKSBkZXBvc2l0cyB0byBhZGRcbiAgZGVwb3NpdHMucHVzaCguLi5nZXRDb2luYmFzZURlcG9zaXRzKGFkZHJlc3MsIGNvaW5iYXNlVHhzKSk7XG5cbiAgY29uc3QgYmFsYW5jZTogbnVtYmVyID0gd2l0aGRyYXdhbHMucmVkdWNlKFxuICAgIChhY2MsIGlucHV0VHgpID0+IGFjYyAtIGlucHV0VHguYW1vdW50LFxuICAgIGluaXRpYWxCYWxhbmNlLFxuICApO1xuXG4gIHJldHVybiBkZXBvc2l0cy5yZWR1Y2UoKGFjYywgb3V0cHV0VHgpID0+IGFjYyArIG91dHB1dFR4LmFtb3VudCwgYmFsYW5jZSk7XG59XG4iXX0=